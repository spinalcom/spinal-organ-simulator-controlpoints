"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

let Utilities = {};
const globalType = typeof window === "undefined" ? global : window;

Utilities.getViewer = function () {
  return new Promise((resolve, reject) => {
    if (globalType.v === "undefined") {
      let interval = setInterval(() => {
        if (globalType.v !== "undefined") {
          resolve(globalType.v);
          clearInterval(interval);
        }
      }, 500);
    } else resolve(globalType.v);
  });
};

Utilities.promiseGetProperties = function (_dbId) {
  return new Promise(resolve => {
    Utilities.getViewer().then(viewer => {
      viewer.getProperties(_dbId, resolve);
    });
  });
};

Utilities.promiseGetExternalIdMapping = function (_externalId) {
  return new Promise(resolve => {
    Utilities.getViewer().then(viewer => {
      viewer.model.getExternalIdMapping(res => {
        resolve(res[_externalId]);
      });
    });
  });
};

// Utilities.promiseLoad = function(_ptr) {
//   return new Promise(resolve => {
//     _ptr.load(resolve);
//   });
// }
Utilities.promiseLoad = function (_ptr) {
  if (_ptr instanceof globalType.Ptr && _ptr.data.value != 0 && typeof FileSystem._objects[_ptr.data.value] != "undefined") return Promise.resolve(FileSystem._objects[_ptr.data.value]);else return new Promise(resolve => {
    _ptr.load(resolve);
  });
};

Utilities.getExternalId = (() => {
  var _ref = _asyncToGenerator(function* (_dbId) {
    let properties = yield Utilities.promiseGetProperties(_dbId);
    return properties.externalId;
  });

  return function (_x) {
    return _ref.apply(this, arguments);
  };
})();

Utilities.getDbIdByExternalId = (() => {
  var _ref2 = _asyncToGenerator(function* (_externalId) {
    let dbid = yield Utilities.promiseGetExternalIdMapping(_externalId);
    return dbid;
  });

  return function (_x2) {
    return _ref2.apply(this, arguments);
  };
})();

Utilities.arraysEqual = function (arrayA, arrayB) {
  if (arrayA === arrayB) return true;
  if (arrayA == null || arrayB == null) return false;
  if (arrayA.length != arrayB.length) return false;
  arrayA.sort();
  arrayB.sort();
  for (var i = 0; i < arrayA.length; ++i) {
    if (arrayA[i] !== arrayB[i]) return false;
  }
  return true;
};

Utilities.containsLstById = function (_list, _node) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.id.get() == _node.id.get()) return true;
  }
  return false;
};

Utilities.containsLstModel = function (_list, _model) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.get() == _model.get()) return true;
  }
  return false;
};

Utilities.containsLst = function (_list, _element) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.get() == _element) return true;
  }
  return false;
};

Utilities.include = function (arr, obj) {
  return arr.indexOf(obj) != -1;
};

Utilities.getIndex = function (arr, obj) {
  return arr.indexOf(obj);
};

Utilities.getIds = function (array) {
  let res = [];
  for (let index = 0; index < array.length; index++) {
    res.push(array[index].id.get());
  }
  return res;
};
// Utilities.addNotExisting = function(arr, obj) {
//   return (arr.indexOf(obj));
// }

Utilities.concat = function (listA, listB) {
  let res = [];
  for (let index = 0; index < listA.length; index++) {
    res.push(listA[index]);
  }
  for (let index = 0; index < listB.length; index++) {
    res.push(listB[index]);
  }
  return res;
};

Utilities.allButMeById = function (_list, _node) {
  let res = [];
  for (let index = 0; index < _list.length; index++) {
    const node = _list[index];
    if (node.id.get() != _node.id.get()) {
      res.push(node);
    }
    return res;
  }
};

Utilities.guid = function (_constructor) {
  return _constructor + "-" + this.s4() + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + this.s4() + this.s4() + "-" + Date.now().toString(16);
};

Utilities.s4 = function () {
  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
};

Utilities.putOnTopLst = function (lst, elementB) {
  lst.remove_ref(elementB);
  lst.unshift(elementB);
  // for (let index = 0; index < lst.length; index++) {
  //   const element = lst[index];
  //   if (element.id.get() === elementB.id.get()) {
  //     lst.remove(index);
  //   }

  // }
};

exports.Utilities = Utilities;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9VdGlsaXRpZXMuanMiXSwibmFtZXMiOlsiVXRpbGl0aWVzIiwiZ2xvYmFsVHlwZSIsIndpbmRvdyIsImdsb2JhbCIsImdldFZpZXdlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidiIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwicHJvbWlzZUdldFByb3BlcnRpZXMiLCJfZGJJZCIsInRoZW4iLCJ2aWV3ZXIiLCJnZXRQcm9wZXJ0aWVzIiwicHJvbWlzZUdldEV4dGVybmFsSWRNYXBwaW5nIiwiX2V4dGVybmFsSWQiLCJtb2RlbCIsImdldEV4dGVybmFsSWRNYXBwaW5nIiwicmVzIiwicHJvbWlzZUxvYWQiLCJfcHRyIiwiUHRyIiwiZGF0YSIsInZhbHVlIiwiRmlsZVN5c3RlbSIsIl9vYmplY3RzIiwibG9hZCIsImdldEV4dGVybmFsSWQiLCJwcm9wZXJ0aWVzIiwiZXh0ZXJuYWxJZCIsImdldERiSWRCeUV4dGVybmFsSWQiLCJkYmlkIiwiYXJyYXlzRXF1YWwiLCJhcnJheUEiLCJhcnJheUIiLCJsZW5ndGgiLCJzb3J0IiwiaSIsImNvbnRhaW5zTHN0QnlJZCIsIl9saXN0IiwiX25vZGUiLCJpbmRleCIsImVsZW1lbnQiLCJpZCIsImdldCIsImNvbnRhaW5zTHN0TW9kZWwiLCJfbW9kZWwiLCJjb250YWluc0xzdCIsIl9lbGVtZW50IiwiaW5jbHVkZSIsImFyciIsIm9iaiIsImluZGV4T2YiLCJnZXRJbmRleCIsImdldElkcyIsImFycmF5IiwicHVzaCIsImNvbmNhdCIsImxpc3RBIiwibGlzdEIiLCJhbGxCdXRNZUJ5SWQiLCJub2RlIiwiZ3VpZCIsIl9jb25zdHJ1Y3RvciIsInM0IiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwic3Vic3RyaW5nIiwicHV0T25Ub3BMc3QiLCJsc3QiLCJlbGVtZW50QiIsInJlbW92ZV9yZWYiLCJ1bnNoaWZ0Il0sIm1h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LE9BQUosQ0FBWUYsUUFBWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDRCxDQVZEOztRQWFFN0UsUyxHQUFBQSxTIiwiZmlsZSI6IlV0aWxpdGllcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCBVdGlsaXRpZXMgPSB7fTtcbmNvbnN0IGdsb2JhbFR5cGUgPSB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDogd2luZG93O1xuXG5VdGlsaXRpZXMuZ2V0Vmlld2VyID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgaWYgKGdsb2JhbFR5cGUudiA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgbGV0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAoZ2xvYmFsVHlwZS52ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgcmVzb2x2ZShnbG9iYWxUeXBlLnYpO1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICB9XG4gICAgICB9LCA1MDApO1xuICAgIH0gZWxzZSByZXNvbHZlKGdsb2JhbFR5cGUudik7XG4gIH0pO1xufTtcblxuVXRpbGl0aWVzLnByb21pc2VHZXRQcm9wZXJ0aWVzID0gZnVuY3Rpb24oX2RiSWQpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIFV0aWxpdGllcy5nZXRWaWV3ZXIoKS50aGVuKHZpZXdlciA9PiB7XG4gICAgICB2aWV3ZXIuZ2V0UHJvcGVydGllcyhfZGJJZCwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuVXRpbGl0aWVzLnByb21pc2VHZXRFeHRlcm5hbElkTWFwcGluZyA9IGZ1bmN0aW9uKF9leHRlcm5hbElkKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBVdGlsaXRpZXMuZ2V0Vmlld2VyKCkudGhlbih2aWV3ZXIgPT4ge1xuICAgICAgdmlld2VyLm1vZGVsLmdldEV4dGVybmFsSWRNYXBwaW5nKHJlcyA9PiB7XG4gICAgICAgIHJlc29sdmUocmVzW19leHRlcm5hbElkXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbn1cblxuXG4vLyBVdGlsaXRpZXMucHJvbWlzZUxvYWQgPSBmdW5jdGlvbihfcHRyKSB7XG4vLyAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbi8vICAgICBfcHRyLmxvYWQocmVzb2x2ZSk7XG4vLyAgIH0pO1xuLy8gfVxuVXRpbGl0aWVzLnByb21pc2VMb2FkID0gZnVuY3Rpb24oX3B0cikge1xuICBpZiAoXG4gICAgX3B0ciBpbnN0YW5jZW9mIGdsb2JhbFR5cGUuUHRyICYmXG4gICAgX3B0ci5kYXRhLnZhbHVlICE9IDAgJiZcbiAgICB0eXBlb2YgRmlsZVN5c3RlbS5fb2JqZWN0c1tfcHRyLmRhdGEudmFsdWVdICE9IFwidW5kZWZpbmVkXCJcbiAgKVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoRmlsZVN5c3RlbS5fb2JqZWN0c1tfcHRyLmRhdGEudmFsdWVdKTtcbiAgZWxzZVxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIF9wdHIubG9hZChyZXNvbHZlKTtcbiAgICB9KTtcbn07XG5cblxuXG5cblV0aWxpdGllcy5nZXRFeHRlcm5hbElkID0gYXN5bmMgZnVuY3Rpb24oX2RiSWQpIHtcbiAgbGV0IHByb3BlcnRpZXMgPSBhd2FpdCBVdGlsaXRpZXMucHJvbWlzZUdldFByb3BlcnRpZXMoX2RiSWQpO1xuICByZXR1cm4gcHJvcGVydGllcy5leHRlcm5hbElkO1xufTtcblxuVXRpbGl0aWVzLmdldERiSWRCeUV4dGVybmFsSWQgPSBhc3luYyBmdW5jdGlvbihfZXh0ZXJuYWxJZCkge1xuICBsZXQgZGJpZCA9IGF3YWl0IFV0aWxpdGllcy5wcm9taXNlR2V0RXh0ZXJuYWxJZE1hcHBpbmcoX2V4dGVybmFsSWQpO1xuICByZXR1cm4gZGJpZDtcbn07XG5cblV0aWxpdGllcy5hcnJheXNFcXVhbCA9IGZ1bmN0aW9uKGFycmF5QSwgYXJyYXlCKSB7XG4gIGlmIChhcnJheUEgPT09IGFycmF5QikgcmV0dXJuIHRydWU7XG4gIGlmIChhcnJheUEgPT0gbnVsbCB8fCBhcnJheUIgPT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICBpZiAoYXJyYXlBLmxlbmd0aCAhPSBhcnJheUIubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gIGFycmF5QS5zb3J0KCk7XG4gIGFycmF5Qi5zb3J0KCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlBLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKGFycmF5QVtpXSAhPT0gYXJyYXlCW2ldKSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5VdGlsaXRpZXMuY29udGFpbnNMc3RCeUlkID0gZnVuY3Rpb24oX2xpc3QsIF9ub2RlKSB7XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfbGlzdC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICBjb25zdCBlbGVtZW50ID0gX2xpc3RbaW5kZXhdO1xuICAgIGlmIChlbGVtZW50LmlkLmdldCgpID09IF9ub2RlLmlkLmdldCgpKSByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5VdGlsaXRpZXMuY29udGFpbnNMc3RNb2RlbCA9IGZ1bmN0aW9uKF9saXN0LCBfbW9kZWwpIHtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9saXN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBfbGlzdFtpbmRleF07XG4gICAgaWYgKGVsZW1lbnQuZ2V0KCkgPT0gX21vZGVsLmdldCgpKSByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5VdGlsaXRpZXMuY29udGFpbnNMc3QgPSBmdW5jdGlvbihfbGlzdCwgX2VsZW1lbnQpIHtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9saXN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBfbGlzdFtpbmRleF07XG4gICAgaWYgKGVsZW1lbnQuZ2V0KCkgPT0gX2VsZW1lbnQpIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblV0aWxpdGllcy5pbmNsdWRlID0gZnVuY3Rpb24oYXJyLCBvYmopIHtcbiAgcmV0dXJuIGFyci5pbmRleE9mKG9iaikgIT0gLTE7XG59O1xuXG5VdGlsaXRpZXMuZ2V0SW5kZXggPSBmdW5jdGlvbihhcnIsIG9iaikge1xuICByZXR1cm4gYXJyLmluZGV4T2Yob2JqKTtcbn07XG5cblV0aWxpdGllcy5nZXRJZHMgPSBmdW5jdGlvbihhcnJheSkge1xuICBsZXQgcmVzID0gW107XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhcnJheS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICByZXMucHVzaChhcnJheVtpbmRleF0uaWQuZ2V0KCkpO1xuICB9XG4gIHJldHVybiByZXM7XG59O1xuLy8gVXRpbGl0aWVzLmFkZE5vdEV4aXN0aW5nID0gZnVuY3Rpb24oYXJyLCBvYmopIHtcbi8vICAgcmV0dXJuIChhcnIuaW5kZXhPZihvYmopKTtcbi8vIH1cblxuVXRpbGl0aWVzLmNvbmNhdCA9IGZ1bmN0aW9uKGxpc3RBLCBsaXN0Qikge1xuICBsZXQgcmVzID0gW107XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsaXN0QS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICByZXMucHVzaChsaXN0QVtpbmRleF0pO1xuICB9XG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsaXN0Qi5sZW5ndGg7IGluZGV4KyspIHtcbiAgICByZXMucHVzaChsaXN0QltpbmRleF0pO1xuICB9XG4gIHJldHVybiByZXM7XG59O1xuXG5VdGlsaXRpZXMuYWxsQnV0TWVCeUlkID0gZnVuY3Rpb24oX2xpc3QsIF9ub2RlKSB7XG4gIGxldCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9saXN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IG5vZGUgPSBfbGlzdFtpbmRleF07XG4gICAgaWYgKG5vZGUuaWQuZ2V0KCkgIT0gX25vZGUuaWQuZ2V0KCkpIHtcbiAgICAgIHJlcy5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG59O1xuXG5VdGlsaXRpZXMuZ3VpZCA9IGZ1bmN0aW9uKF9jb25zdHJ1Y3Rvcikge1xuICByZXR1cm4gKFxuICAgIF9jb25zdHJ1Y3RvciArXG4gICAgXCItXCIgK1xuICAgIHRoaXMuczQoKSArXG4gICAgdGhpcy5zNCgpICtcbiAgICBcIi1cIiArXG4gICAgdGhpcy5zNCgpICtcbiAgICBcIi1cIiArXG4gICAgdGhpcy5zNCgpICtcbiAgICBcIi1cIiArXG4gICAgdGhpcy5zNCgpICtcbiAgICBcIi1cIiArXG4gICAgdGhpcy5zNCgpICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIHRoaXMuczQoKSArXG4gICAgXCItXCIgK1xuICAgIERhdGUubm93KCkudG9TdHJpbmcoMTYpXG4gICk7XG59O1xuXG5VdGlsaXRpZXMuczQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgLnRvU3RyaW5nKDE2KVxuICAgIC5zdWJzdHJpbmcoMSk7XG59O1xuXG5VdGlsaXRpZXMucHV0T25Ub3BMc3QgPSBmdW5jdGlvbihsc3QsIGVsZW1lbnRCKSB7XG4gIGxzdC5yZW1vdmVfcmVmKGVsZW1lbnRCKTtcbiAgbHN0LnVuc2hpZnQoZWxlbWVudEIpO1xuICAvLyBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbHN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAvLyAgIGNvbnN0IGVsZW1lbnQgPSBsc3RbaW5kZXhdO1xuICAvLyAgIGlmIChlbGVtZW50LmlkLmdldCgpID09PSBlbGVtZW50Qi5pZC5nZXQoKSkge1xuICAvLyAgICAgbHN0LnJlbW92ZShpbmRleCk7XG4gIC8vICAgfVxuXG4gIC8vIH1cbn07XG5cbmV4cG9ydCB7XG4gIFV0aWxpdGllc1xufTsiXX0=